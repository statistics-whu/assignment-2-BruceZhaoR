---
title: "第二次作业"
author: "赵炜"
geometry: "left=2.5cm,right=2cm,top=3cm,bottom=2.5cm"
header-includes:
  - \usepackage{ctex}
output: 
  pdf_document:
    fig_caption: yes
    latex_engine: xelatex
    number_sections: yes
    toc: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  out.width = "100%", 
  fig.showtext = TRUE,
  fig.align = "center",
  comment = "#>",
  df_print = "tibble",
  paged.print = FALSE,
  split = FALSE
)

library(showtext)

showtext_auto()

# 添加微软雅黑字体
font_add("Microsoft YaHei", "C:/Windows/Fonts/msyh.ttc")

```


```{r}
options(scipen = 1, digits = 3)
library(tidyverse)
# 这里family设置成你系统中的中文字体名。
old <- theme_set(theme(text=element_text(family="Microsoft YaHei",size=14))+
                   theme_minimal())
# 还原默认主题
# theme_set(old)
```


<!-- ```{r setup, include = FALSE,echo = FALSE} -->
<!-- knitr::opts_chunk$set(echo = FALSE,error = FALSE, warning = FALSE, message = FALSE, -->
<!--                       out.width = "100%", split = FALSE, fig.align = "center",dev="cairo_pdf",fig.pos='H') -->

<!-- #load library -->
<!-- library(tidyverse) # data manipulation -->
<!-- library(kableExtra) # nice table -->
<!-- library(broom) -->
<!-- library(modelr) -->
<!-- library(stats) -->
<!-- library(lubridate) -->
<!-- library(infer) -->
<!-- library(kableExtra) -->
<!-- library(scales) -->
<!-- theme_set(theme(text = element_text(family="Helvetica",size = 10))) -->
<!-- filepath ="/Users/jameschen/Documents/02_Teaching/12_quantitative_thinking_R/assignments/r2" # the data file path, replace the path with yours. -->
<!-- options(scipen = 1, digits = 2) -->
<!-- ``` -->

# Question #1: 

BigBangTheory. (Attached Data: BigBangTheory)

## 测试中文

*The Big Bang Theory*, a situation comedy featuring Johnny Galecki, Jim Parsons, and Kaley Cuoco-Sweeting, is one of the most-watched programs on network television. The first two episodes for the 2011–2012 season premiered on September 22, 2011; the first episode attracted 14.1 million viewers and the second episode attracted 14.7 million viewers. The attached data file BigBangTheory shows the number of viewers in millions for the first 21 episodes of the 2011–2012 season (*the Big Bang theory* website, April 17, 2012).

```{r}
# read data
data_q1 <- read_csv("data/BigBangTheory.csv") %>% 
  rename(viewers = `Viewers (millions)`, air_date = `Air Date`) %>% 
  mutate(air_date = mdy(air_date))
data_q1
```

a. Compute the minimum and the maximum number of viewers.

```{r}
data_q1 %>% 
  summarise(min_viewrs = min(viewers),
            max_viewers = max(viewers))
```
number of viewers 最小值为 `13.3`, 最大值为`16.5`。

b. Compute the mean, median, and mode.

```{r}

# 平均值 和中位数
data_q1 %>% 
  summarise(mean_viewrs = mean(viewers),
            median_viewers = median(viewers)
  )

# 众数
data_q1 %>% 
 count(viewers) %>% 
  slice_max(order_by = n)

```
平均值为 `15.0`, 中位数为`15` 众数有3个，分别是 `13.6, 14, 16.1, 16.2` 出现的次数均为2。

c. Compute the first and third quartiles.

```{r}
data_q1 %>% 
  summarise(q1 = quantile(viewers, probs = 0.25),
            q3 = quantile(viewers, probs = 0.75))
```
1/4分位数为 `14.1`, 3/4分位数为 `16`。


d. has viewership grown or declined over the 2011–2012 season? Discuss.
```{r}
ggplot(data_q1,aes(air_date,viewers)) +
         geom_point(size=2) +
         geom_line() + 
  scale_x_date(date_breaks = "1 months", date_labels = "%Y-%m-%d") +
  labs(title = "观看量随日期点线趋势图") +
  geom_smooth(se=FALSE)
```
总体来看，第二季的收视率比第一季高，有上升趋势；但是结尾部分收视率急速下滑，可能是大家对结尾不感兴趣了。



# Question #2: 

NBAPlayerPts. (Attached Data: NBAPlayerPts)

CbSSports.com developed the Total Player Rating system to rate players in the National Basketball Association (NBA) based on various offensive and defensive statistics. The attached data file NBAPlayerPts shows the average number of points scored per game (PPG) for 50 players with the highest ratings for a portion of the 2012–2013 NBA season (CbSSports.com website, February 25, 2013). Use classes starting at 10 and ending at 30 in increments of 2 for PPG in the following.

```{r}
data_q2 <- read_csv("data/NBAPlayerPts.csv")
data_q2 <- data_q2 %>%
  mutate(class = cut(PPG, breaks = seq(
    from = 10, to = 30, by = 2
  )))
data_q2
```
a. Show the frequency distribution.
```{r}
ggplot(data_q2 %>% count(class),aes(x=class,y=n)) +
  geom_col()+
  geom_text(aes(label = n),vjust = -0.2)+
  labs(title = "场均得分PPG分组频数图") +
  xlab("PPG分组") +
  ylab("次数")
```


b. Show the relative frequency distribution.

```{r fig.height=3, fig.width=6}
table(data_q2$class) / nrow(data_q2)

ggplot(data_q2 %>% count(class), aes(x = "", group = class, y = n)) +
  geom_col(aes(fill = class),position = "fill") +
  coord_flip() +
  labs(title = "各分组占比 -- relative frequency distribution",
       fill = "得分分组") +
  xlab("") +
  ylab("")
  
```


c. Show the cumulative percent frequency distribution.
```{r}
data_q2 %>%
  count(class) %>%
  mutate(prop_n = n / sum(n), cusum_prop = cumsum(n) / sum(n))

data_q2 %>%
  count(class) %>%
  mutate(prop_n = n / sum(n), cusum_prop = cumsum(n) / sum(n),
         x=row_number()) %>% 
  ggplot(aes(x=class, y = cusum_prop))+
  geom_point(size = 2)+
  geom_line(aes(x = x, y = cusum_prop),color = "red")+
  xlab("PPG分组") +
  ylab("累计占比")+
  ggtitle("Cumulative percent frequency distribution")
```
累计占比，请见表格的`cusum_prop`列，分区情况请见图。

d. Develop a histogram for the average number of points scored per game.
```{r}
ggplot(data_q2,aes(PPG)) + 
  geom_histogram(binwidth = 2,fill="grey50",color = "black") 
```

e. Do the data appear to be skewed? Explain.

```{r}
e1071::skewness(data_q2$PPG)
```
通过计算偏度得到值为为`1.1`, 结合长尾直方图，可以判断PPG的数据是右偏的。

f. What percentage of the players averaged at least 20 points per game?

```{r}
data_q2 %>% 
  filter(PPG>=20) %>% 
  tally() / nrow(data_q2) 
```
PPG大于等于20分的球员占比为 22%。



# Question #3

A researcher reports survey results by stating that the standard error of the mean is 20. The population standard deviation is 500.

$$
se = \sigma_{\bar{x}} = \frac{ \sigma } { \sqrt{n} } \\
n = \frac{\sigma^2}{se^2} 
$$

a. How large was the sample used in this survey?
```{r}
se = 20
sigma = 500

sigma^2 / se^2
```
至少需要625个样本。


b. What is the probability that the point estimate was within ±25 of the population mean?

样本量足够大，可以认为均值服从正态分布 $N ~ (\bar{x}, \sigma / \sqrt{n})$    

$$P(x \le \bar{x} + 25) = \Phi(\frac{25}{ \sigma_{\bar{x}}}) \\
P(x \le \bar{x} - 25) = \Phi(\frac{-25}{ \sigma_{\bar{x}}}) \\
P(\bar{x} -25 \le x \le \bar{x} +25)  = \Phi(\frac{25}{ \sigma_{\bar{x}}}) - \Phi(\frac{-25}{ \sigma_{\bar{x}}})
$$
```{r}
pnorm(25/20) - pnorm(-25/20) 

```
总体均值的点估计在±25之间的概率为 `0.79`。



# Question #4

Young Professional Magazine (Attached Data: Professional)

*Young Professional* magazine was developed for a target audience of recent college graduates who are in their first 10 years in a business/professional career. In its two years of publication, the magazine has been fairly successful. Now the publisher is interested in expanding the magazine’s advertising base. Potential advertisers continually ask about the demographics and interests of subscribers to *young Professionals*. To collect this information, the magazine commissioned a survey to develop a profile of its subscribers. The survey results will be used to help the magazine choose articles of interest and provide advertisers with a profile of subscribers. As a new employee of the magazine, you have been asked to help analyze the survey results.

Some of the survey questions follow:

1. What is your age?

2. Are you: Male_________ Female___________

3. Do you plan to make any real estate purchases in the next two years?
   
   Yes______ No______

4. What is the approximate total value of financial investments, exclusive of your home, owned by you or members of your household?

5. How many stock/bond/mutual fund transactions have you made in the past year?

6. Do you have broadband access to the Internet at home? Yes______ No______

7. Please indicate your total household income last year. ___________

8. Do you have children? Yes______ No______

The file entitled Professional contains the responses to these questions. 

**Managerial Report:**

Prepare a managerial report summarizing the results of the survey. In addition to statistical summaries, discuss how the magazine might use these results to attract advertisers. You might also comment on how the survey results could be used by the magazine’s editors to identify topics that would be of interest to readers. Your report should address the following issues, but do not limit your analysis to just these areas.


```{r message=FALSE, warning=FALSE}
data_q4 <- read_csv("data/Professional.csv",col_select = 1:8) %>%
  rename(
    age = Age,
    gender = Gender,
    buy_estate = `Real Estate Purchases?`,
    value_investment = `Value of Investments ($)`,
    num_transaction = `Number of Transactions`,
    access_internet = `Broadband Access?`,
    ttl_income = `Household Income ($)`,
    have_child = `Have Children?`
  ) %>%
  select(1:8) %>%
  mutate(across(is.character, as_factor))

data_q4
```
a. Develop appropriate descriptive statistics to summarize the data.

```{r}
summary(data_q4)
```

b. Develop 95% confidence intervals for the mean age and household income of subscribers.

```{r}
age_bar = mean(data_q4$age)
age_sigma = sd(data_q4$age)

income_bar = mean(data_q4$ttl_income)
income_sigma = sd(data_q4$ttl_income)

# 总体方差未知，使用t分布
n = nrow(data_q4)
t_alpha = qt(0.975, df = n - 1)
```

总体方差未知，样本均值的区间估计公式为：

$$
\bar{x} \, \pm \, t_{\alpha/2} \, \times \, \frac{s}{\sqrt{n}}  
$$
年龄均值的95%的置信区间为 [ $`r age_bar - t_alpha * age_sigma / sqrt(n)`$, $`r age_bar + t_alpha * age_sigma / sqrt(n)`$] 。

家庭总收入ttl_income的均值的95%的置信区间为 [ $`r income_bar - t_alpha * income_sigma / sqrt(n)`$, $`r income_bar + t_alpha * income_sigma / sqrt(n)`$] 。

c. Develop 95% confidence intervals for the proportion of subscribers who have broadband access at home and the proportion of subscribers who have children.

```{r}
p_hat_1 = mean(data_q4$access_internet == "Yes")
p_hat_1

p_hat_2 = mean(data_q4$have_child == "Yes")
p_hat_2


z_alpha = qnorm(0.975)
z_alpha
```

样本比例的区间估计公式为：

$$
\hat{p} \, \pm \, Z_{\alpha/2} \, \times \sqrt{\frac{\hat{p}*(1-\hat{p})}{n}} 
$$

家中有宽带比例的95%的置信区间为 [ `r p_hat_1 - z_alpha * sqrt(p_hat_1*(1-p_hat_1)/n)` , `r p_hat_1 + z_alpha * sqrt(p_hat_1*(1-p_hat_1)/n)`]

有孩子的比例的95%的置信区间为 [ `r p_hat_2 - z_alpha * sqrt(p_hat_2*(1-p_hat_2)/n)` , `r p_hat_2 + z_alpha * sqrt(p_hat_2*(1-p_hat_2)/n)`]

d. Would *Young Professional* be a good advertising outlet for online brokers? Justify your conclusion with statistical data.



e. Would this magazine be a good place to advertise for companies selling educational software and computer games for young children?


f. Comment on the types of articles you believe would be of interest to readers of *Young Professional*.











